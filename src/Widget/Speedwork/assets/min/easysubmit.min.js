!function(t){var e="easySubmit",i={target:"",reload:!1,return_url:null,validate:!0,onComplete:function(){},onFailed:function(){},inputEvent:"blur"},s=function(e,s){this.element=e,this.settings=t.extend({},i,s),t.metadata&&(this.settings=t.extend({},this.settings,e.metadata({type:"class"})),this.settings=t.extend({},this.settings,e.metadata({type:"html5"}))),this.form=e.is("form")?e:e.parents("form:eq(0)"),e.is("form")?(this.target=e.find(".clicked")||e.find("[type=submit]"),"undefined"!=typeof e.data("submit-target")&&(this.target=t(e.data("submit-target")))):this.target=this,1==this.settings.validate?this.validate():this.formSubmit()};s.prototype.validate=function(){var t=this;this.form.validator(t.settings).submit(function(e){if(!e.isDefaultPrevented())return t.callback("onValidationSuccess",{}),t.form.attr({valid:!0}),t.formSubmit(),!1;t.callback("onValidationFail",{}),e.preventDefault(),t.form.attr({valid:!1});var i=t.form.attr("message")||_e("Please correct the highlighted error(s)");noty({text:i,type:"error"})})},s.prototype.formSubmit=function(){var e=this,i=(this.settings.beforeSubmit||this.beforeSubmit,this.settings.success||this.success,this.settings.onProgress||this.progress,{beforeSubmit:function(){e.beforeSubmit()},success:function(t){e.success(t)},uploadProgress:function(t,i,s,r){e.progress(r,s,i)},format:"json",data:{format:"json"}}),s=t.extend({},this.settings,i);this.element.ajaxSubmit(s)},s.prototype.beforeSubmit=function(){var t=this.form.data("confirm");return void 0==t||""==t||t(t)?(this.addLoading(),!0):!1},s.prototype.addLoading=function(){var t=this.target;if("object"==typeof t)if(t.attr("disabled",!0),t.attr("value")&&t.data("value",t.attr("value")),t.addClass("loader"),void 0!=t.data("loader")){var e=t.data("loader").split(";");t.val(e[0])}else t.val(_e("Please wait..."))},s.prototype.removeLoading=function(){var t=this.target;"object"==typeof t&&(t.attr("disabled",!1),t.removeClass("loader"),t.val(t.data("value")))},s.prototype.progress=function(e,i,s){this.settings.progress&&t(this.settings.progress).width(e+"%");var r=this.form.find("#onProgress").val();if(""!=r&&void 0!=r){var a=window[r];"function"==typeof a&&a(e,i,s,this)}},s.prototype.success=function(e){var i=this;i.removeLoading(),t(".ac-captcha").each(function(){var e=t(this).attr("src");e+=e.indexOf("?")?"&":"?",e+="sid="+Math.random(),t(this).attr({src:e})});try{var s=JSON.parse(e)}catch(r){var s=e;"object"!=typeof s&&(s=null)}if(s===!1||null===s)return noty({text:"Something went wrong and we cannot service your request. Please try again.",type:"error"}),!0;if(i.callback("onComplete",s),s.login&&(s.link={},s.link.url=_link("members/login"),s.link.title="Login to your account"),s.link){var a="tip-link";return t("#"+a).remove(),t("body").append(t('<a id="'+a+'" style="display:none"></a>')),t("#"+a).easyTip({content:{text:function(e,i){return i.set("content.title",s.link.title),i.set("url",s.link.url),t.fn.easyTip.ajaxContent(e,i)}},position:{viewport:!1,at:"center",my:"center",target:t(window)},show:{modal:!0,ready:!0},events:{show:null}}).qtip("show"),!0}if("200"==s.status||"OK"==s.status){if(this.callback("onSuccess",s),s.preview){if(!s.preview.body)return noty({text:"Invalid response from server. Please try again.",type:"error"}),!0;var n=s.preview.title||"Preview",a="tip-preview";return t("#"+a).remove(),t("body").append(t('<a id="'+a+'" style="display:none" title="'+n+'">'+n+"</a>")),t("#"+a).easyTip({content:{text:s.preview.body},position:{viewport:!1,at:"center",my:"center",target:t(window)},show:{modal:!0,ready:!0,solo:!0},events:{show:null}}).qtip("show"),!0}s.message&&noty({text:s.message,type:"success"}),i.settings.alert&&alert(s.message),i.settings.reset&&i.form.resetForm(),i.settings.clear&&i.form.clearForm(),i.settings.hide&&t.fn.qtip&&setTimeout(function(){t("*").qtip("hide")},1e3);var o=i.form.find("#return_url").val();i.settings.return_url?i.redirect(return_url,1e3):""!=o&&void 0!=o?i.redirect(o,1e3):i.settings.reload&&setTimeout("location.reload(true);",1e3),i.settings.render&&(t("#page").val(1),ajaxPagination.load());var l=i.settings.submit;"parent"==l?i.form.closest("form").submit():l&&t(i.settings.submit).submit(),s.redirect&&i.redirect(s.redirect,1e3)}else if("INFO"==s.status)s.message&&noty({text:s.message,type:"information"}),i.callback("onInfo",s);else{if("undefined"==typeof s.status&&s.redirect)return i.redirect(s.redirect,1e3),!0;s.message&&noty({text:s.message,type:"error"}),s.errors&&i.form.data("validator").invalidate(s.errors),i.callback("onFailed",s)}i.settings.target&&t(i.settings.target).empty().show().html(message)},s.prototype.redirect=function(t,e){var i=e?e:0,t=t.replace("&","&");setTimeout(function(){window.top.location.href=t},i)},s.prototype.callback=function(t,e){var i=this,s=i.settings[t];if(s&&"undefined"!=typeof s)if("function"==typeof s)s(e,i,i.settings);else{var r=window[s];"function"==typeof r&&r(e,i,i.settings)}var a=t.toLowerCase(),s=i.settings[a];if(s&&"undefined"!=typeof s)if("function"==typeof s)s(e,i,i.settings);else{var r=window[s];"function"==typeof r&&r(e,i,i.settings)}var s=i.form.find("#"+t).val();if(""!=s&&"undefined"!=typeof s){var r=window[s];"function"==typeof r&&r(e,i,i.settings)}},t.fn.easySubmit=function(i){return this.each(function(){t.data(this,e)||t.data(this,e,new s(t(this),i))})}}(jQuery);